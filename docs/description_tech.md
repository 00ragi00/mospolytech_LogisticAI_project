# Описание технологии Telegram Math Bot

## Введение

Добро пожаловать в документацию технологии MathBot — инновационного Telegram-бота, разработанного для помощи в решении математических задач с использованием современных технологий искусственного интеллекта. Этот проект представляет собой сочетание программирования на Python, интеграции с Telegram API и мощной нейронной сети Qwen2.5-VL 7B Instruct, предоставляемой через OpenRouter API. Документ подробно описывает этапы исследования предметной области, функционал бота, проведенные модификации, архитектуру системы и процессы разработки. Документ предназначен для разработчиков, студентов и энтузиастов, интересующихся созданием интеллектуальных приложений.

Целью создания MathBot стало упрощение обучения математике и предоставление пользователям удобного инструмента для решения задач любого уровня сложности. За год разработки проект эволюционировал, приобретая новые функции и улучшая производительность. В этом документе мы разберем каждый аспект технологии, включая теоретическую базу, практическую реализацию и перспективы развития.

---

## 1. Исследование предметной области

### 1.1. Определение проблемы
Исследование началось с анализа потребностей пользователей в образовательной сфере. Было выявлено, что многие студенты и школьники сталкиваются с трудностями в решении математических задач, особенно в таких областях, как уравнения, интегралы и дроби. Традиционные учебные материалы часто не предоставляют мгновенной обратной связи, а репетиторы недоступны по времени или стоимости. Это создало потребность в автоматизированном инструменте, который мог бы не только решать задачи, но и обучать пользователей через интерактивные примеры.

### 1.2. Анализ существующих решений
Были изучены существующие образовательные боты и приложения:
- Wolfram Alpha: Мощный инструмент для решения математических задач, но требует платной подписки для расширенных функций и не интерактивен.
- PhotoMath: Приложение для распознавания уравнений с фото, но оно не предоставляет пошаговых решений и не обучает.
- Telegram-боты: Некоторые боты (например, для перевода или игр) используют API, но математические боты с ИИ были редкостью.

Преимущества конкурентов включали быструю обработку, но отсутствовала интерактивность и поддержка обучения. Это определило направление разработки: создание бота, который сочетает в себе решение задач и образовательный функционал.

### 1.3. Выбор технологий
Для реализации проекта были выбраны следующие технологии:
- Python: Из-за простоты синтаксиса и большого числа библиотек для работы с ИИ и API.
- aiogram: Библиотека для создания Telegram-ботов с асинхронной поддержкой.
- OpenRouter API с Qwen2.5-VL 7B Instruct: Модель ИИ, способная обрабатывать текст и изображения, что идеально подходит для распознавания математических выражений.
- aiohttp: Для асинхронных HTTP-запросов к API.
- python-dotenv: Для безопасного хранения токенов.

### 1.4. Сбор требований
Были определены ключевые требования:
- Возможность ввода задач в текстовом формате (например, 2x = 4).
- Поддержка фотографий с рукописными или напечатанными уравнениями.
- Режим обучения с генерацией примеров по темам (линейные уравнения, интегралы и т.д.).
- Пошаговые решения с объяснениями.
- Простота использования через Telegram.

Исследование заняло около двух месяцев, включая тестирование прототипов и выбор оптимальной модели ИИ.

---

## 2. Описание бота, функционал

### 2.1. Общая концепция
MathBot — это Telegram-бот, разработанный для автоматизации решения математических задач и обучения пользователей. Он использует нейронную сеть Qwen2.5-VL 7B Instruct для анализа текстов и изображений, предоставляя ответы в формате "Ответ: [число]\nРешение: [объяснение]" с лимитом в 100 символов. Бот доступен через команды и интерактивные кнопки, что делает его удобным для широкой аудитории.

### 2.2. Основные функции
- Решение задач:
  - Пользователь отправляет текстовое выражение (например, 2x + 3 = 7), и бот возвращает решение (Ответ: 2\nРешение: 2x = 4, x = 2).
  - Поддержка фотографий: бот распознает уравнения на изображениях (например, рукописный x^2 = 4).
- Режим обучения:
  - Пользователь выбирает тему (например, "Решение квадратных уравнений") через кнопку "Обучение".
  - Бот генерирует 3 примера с возрастающей сложностью и проверяет ответы пользователя, предоставляя пояснения к ошибкам.
- Интерфейс:
  - Клавиатура с кнопками "Обучение" и "Решение примеров".
  - Сообщения о процессе: "Обрабатываю фото..." или "Решаю задачу...".
- Обработка ошибок:
  - Если задача не распознана, бот сообщает об этом (например, "Не удалось обработать задачу").

### 2.3. Технические характеристики
- Язык программирования: Python 3.11.
- Библиотеки: aiogram, aiohttp, python-dotenv.
- Модель ИИ: Qwen2.5-VL 7B Instruct (через OpenRouter API).
- Хранилище состояний: Временное хранение в словаре USER_STATES (очищается после проверки ответов).

---

## 3. Модификация

### 3.1. Контекст модификации
За год разработки мы научились работать с более сложными ИИ-моделями и улучшать пользовательский интерфейс. На основе полученных знаний было решено модифицировать MathBot, добавив поддержку мультиязычности и улучшенный режим статистики.

### 3.2. Добавление мультиязычности
- Цель: Сделать бота доступным для пользователей из разных стран.
- Реализация:
  - Добавлен выбор языка при команде /start (русский, английский).
  - Переведены все сообщения и темы обучения.
  - Код для переключения языка:
 
            LANGUAGES = {"ru": "Русский", "en": "English"}
        USER_LANGUAGES = {}

        @dp.message(CommandStart())
        async def send_welcome(message: types.Message):
            keyboard = InlineKeyboardMarkup(inline_keyboard=[
                [InlineKeyboardButton(text=LANGUAGES["ru"], callback_data="lang_ru")],
                [InlineKeyboardButton(text=LANGUAGES["en"], callback_data="lang_en")]
            ])
            await message.reply("Выберите язык / Choose language:", reply_markup=keyboard)

        @dp.callback_query(lambda c: c.data.startswith("lang_"))
        async def set_language(callback: types.CallbackQuery):
            lang = callback.data.split("_")[1]
            USER_LANGUAGES[callback.from_user.id] = lang
            await callback.message.edit_text(
                "Язык установлен! / Language set!" if lang == "ru" else "Language set!",
                reply_markup=create_main_keyboard(lang)
            )
            await callback.answer()
    
  - Сообщения адаптируются в зависимости от выбранного языка (например, "Отправь пример" или "Send an example").
- Результат: Улучшена доступность для международной аудитории.

### 3.3. Улучшенный режим статистики
- Цель: Дать пользователям возможность отслеживать прогресс.
- Реализация:
  - Добавлено хранение статистики в словаре USER_STATS (количество решенных задач, процент правильных ответов).
  - Команда /stats показывает статистику.
  - Код:
    
        USER_STATS = {}

        @dp.message(Command("stats"))
        async def show_stats(message: types.Message):
            user_id = message.from_user.id
            stats = USER_STATS.get(user_id, {"solved": 0, "correct": 0})
            accuracy = (stats["correct"] / stats["solved"] * 100) if stats["solved"] > 0 else 0
            await message.reply(
                f"Статистика: Решено {stats['solved']} задач, "
                f"Правильно {stats['correct']} ({accuracy:.1f}%)"
            )

    # Обновление статистики при решении
    
        async def handle_message(message: types.Message):
            # ... (существующий код) ...
            if not user_id in USER_STATES:
                stats = USER_STATS.get(user_id, {"solved": 0, "correct": 0})
                stats["solved"] += 1
                if "Правильно" in response_text:
                    stats["correct"] += 1
                USER_STATS[user_id] = stats
            # ... (существующий код) ...
    
- Результат: Пользователи могут видеть свой прогресс, что мотивирует к обучению.

---

## 4. Архитектура

### 4.1. Общая структура
Архитектура MathBot представляет собой клиент-серверную систему с тремя основными компонентами:
- Клиент (Пользователь): Взаимодействует с ботом через Telegram.
- Серверная логика (MathBot на Python): Обрабатывает запросы, вызывает API и управляет состоянием.
- Внешний сервис (OpenRouter API): Выполняет вычисления с помощью Qwen2.5-VL 7B Instruct.

### 4.2. Компоненты системы
- Интерфейс пользователя: Telegram-клиент, через который пользователь отправляет команды, текст или фото.
- Логика бота: Python-скрипт с функциями обработки (например, invoke_llm_api, generate_examples).
- API-интеграция: Асинхронные запросы к OpenRouter для анализа данных.
- Хранилище состояний: Временное хранение данных пользователей в памяти (USER_STATES, USER_LANGUAGES, USER_STATS).

### 4.3. Схема архитектуры

![image](https://github.com/user-attachments/assets/dcdc45c9-7689-4890-ad76-57e2920fb8f0)

Описание: Схема показывает взаимодействие компонентов:
- Пользователь отправляет запрос через Telegram.
- MathBot обрабатывает его, используя API и хранилище состояний.
- Результат возвращается пользователю.

### 4.4. Схема взаимодействия данных

![image](https://github.com/user-attachments/assets/22cada15-c292-4262-8e49-48d072b8dfd7)

Описание: Схема иллюстрирует поток данных от ввода пользователя до получения результата.

---

## 5. Процессы технологии

### 5.1. Этапы разработки
1. Планирование (1 месяц):
   - Определение целей и требований.
   - Выбор технологий и API.
2. Прототипирование (2 месяца):
   - Создание базового бота с функцией решения текстовых задач.
   - Тестирование интеграции с OpenRouter API.
3. Разработка основных функций (3 месяца):
   - Добавление поддержки фото и режима обучения.
   - Оптимизация обработки запросов.
4. Тестирование (1 месяц):
   - Проверка на разных устройствах и задачах.
   - Устранение ошибок (например, некорректное распознавание фото).

### 5.2. Тестирование
- Юнит-тесты: Проверка функций (например, generate_examples на корректность примеров).
- Интеграционное тестирование: Проверка взаимодействия с API (отправка запросов и получение ответов).
- Пользовательское тестирование: Привлечение 10 добровольцев для тестирования интерфейса.

### 5.3. Оптимизация
- Сокращение времени обработки до 2-3 секунд за счет асинхронности.
- Ограничение длины ответа до 100 символов для повышения удобства.
- Добавление кэширования простых задач для ускорения (например, 2+2).

---

## Заключение

MathBot — это пример успешного применения ИИ в образовательных технологиях. За год проект прошел путь от простого прототипа до многофункционального бота с мультиязычной поддержкой и статистикой. Архитектура системы обеспечивает масштабируемость, а процессы разработки гарантируют качество. В будущем мы планируем добавить голосовой ввод и поддержку сложных уравнений (например, дифференциальных).
